language: ruby
bundler_args: --local --without development vm ct console debug
rvm:
  - ruby-2.1.2
env:
  - BUNDLER_INCLUDE_DEBUG_GROUP=false

branches:
  except:
    - /build-.+-\d{4}-\d{2}-\d{2}-.*/

before_script:
  - rake db:create:all

# create git tag to support quick rollback to last known good state
before_deploy:
  - git config --global user.email "buildbot@thegarage.us"
  - git config --global user.name "Buildbot (Travis CI)"
  - git buildtag

# see http://docs.travis-ci.com/user/notifications/#HipChat-notification
notifications:
  hipchat: <%= prefs[:hipchat_api_key] %>@<%= prefs[:hipchat_room] %>

deploy:
  provider: heroku
  strategy: git
  run: rake db:migrate
  app:
    master: <%= prefs[:heroku_production_appname] %>
    staging: <%= prefs[:heroku_staging_appname] %>
